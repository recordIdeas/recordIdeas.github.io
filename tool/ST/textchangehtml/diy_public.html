<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文本转换为对应html结构</title>
    <!-- 新 Bootstrap4 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/css/bootstrap.min.css">

    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>

    <!-- bootstrap.bundle.min.js 用于弹窗、提示、下拉菜单，包含了 popper.min.js -->
    <script src="https://cdn.staticfile.org/popper.js/1.15.0/umd/popper.min.js"></script>

    <!-- 最新的 Bootstrap4 核心 JavaScript 文件 -->
    <script src="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
</head>

<body>
    <div class="myPrecautions">
        注意事项：<br>
            1. add buy point: 产品图片右边的买点信息(只能点击一次)<br>
            2. add product details: 插入PRODUCT DETAILS模板(只能点击一次)<br>
            3. sku: 输入sku号,如果此框为空,不能点击“add main img”和“add relate”和“add product details”<br>
            4. add relate: 插入PRODUCT DETAILS的相关内容, 应填写: alt为图片的描述信息, h3为图片下的文本信息标题, p为图片下的文本信息内容   (其中后台上传的图片命名格式:sku-r-01.jpg)<br>
            5. add main img: 插入PRODUCT DETAILS的主图, 应填写此图片的描述信息   (其中后台上传的图片命名格式:sku-main-1.jpg)<br>
            <view class="viewmore">>></view>
        <div class="morecontent">
            6. add h1:大标题, add h2:小标题, add p:正文内容, add li:普通列表, add li span:列表每一项中第一个冒号前面的所有内容加粗<br>
            7. add img: 插入图片, 应填写: alt为图片的描述信息, name为图片名(eg:001.jpg)<br>
            8. add other: 插入无需转换的文本<br>
            9. add note p: 插入PRODUCT DETAILS的Note, 应填写: note的内容(无须写“Note:”)<br>
            10. add specifics h2: 插入PRODUCT DETAILS的product specifics的标题<br>
            11. add specifics li span: 插入PRODUCT DETAILS的product specifics的列表信息<br>
        </div>
    </div>
    <div class="textlist">
        <div class="listEdit">
            <div class="addhtmlButton">
                <div class="reset_allchange">
                    <button class="resetAddhtml">reset Addhtml</button>
                    <button class="deleteAddhtml">delete Addhtml</button>
                    <div>
                        <input type="checkbox" class="allchange">全选
                    </div>
                </div>
                <div>
                    <div>
                        <button class="buyPointbtn tab">Buy Point</button>
                        <button class="detailbtn tab">PRODUCT DETAILS模板</button>
                        <button class="normalbtn tab">自定义</button>
                    </div>
                    <div class="buyPointhtml">
                        <button class="addbuyPoint">add buy point</button>
                    </div>
                    <div class="detailhtml">
                        <input type="text" placeholder="sku" class="sku1" style="width:6em">
                        <div class="sortContent">
                            <input type="text" list="sort" class="sort" placeholder="产品类名(后台上传到此文件夹)">
                          </div>
                        <button class="addpdetail">add product details</button>
                        <button class="addrelate">add relate</button>
                    </div>
                    <div class="normalhtml">
                        <button class="addh1">add h1</button>
                        <button class="addh2">add h2</button>
                        <button class="addp">add p</button>
                        <button class="addli">add li</button>
                        <button class="addlispan">add li span</button>
                        <button class="addimg">add img</button>
                        <button class="addother">add other</button>
                        <br>
                        <input type="text" placeholder="sku" class="sku" style="width:6em">
                        <div class="sortContent">
                            <input type="text" list="sort" class="sort" placeholder="产品类名(后台上传到此文件夹)">
                          </div>
                        <button class="addmainimg">add main img</button>
                        <button class="addnotep">add note p</button>
                        <button class="addspecificsh2">add specifics h2</button>
                        <button class="addspecificslispan">add specifics li span</button>
                        <button class="addrelate">add relate</button>
                    </div>
                </div>
            </div>
            <div id="textEdit1"></div>
            <div id="textEdit2"></div>
            <div id="textEdit3"></div>
        </div>
        <div class="listsubmit">
            <div class="submitButton">
                <button class="resetsubmit">reset submit</button>
                <button class="submit">submit</button>
            </div>
            <textarea id="list1" disabled></textarea>
            <textarea id="list2" disabled></textarea>
            <textarea id="list3" disabled></textarea>
        </div>
        <div class="listpreview">
            <div class="previewButton">
                <button class="resetpreview">reset preview</button>
                <button class="preview">preview</button>
            </div>
            <div id="textli1"></div>
            <div id="textli2"></div>
            <div id="textli3"></div>
        </div>
    </div>
    <style>
    *{
        padding: 0;
        margin: 0;
        list-style: none;
        box-sizing: border-box;
    }

    .sortContent {
        display: inline-block;
        position: relative;
        width: 15em;
        margin-top: 5px;
    }

    .dataList {
        display: none;
        position: absolute;
        width: 100%;
        max-height: 20em;
        overflow: auto;
        border: 1px solid #767676;
        border-top: 0;
    }

    .dataList li,
    .sort {
        width: 100%;
        padding: 0 5px;
        font-size: 1em;
        background: #fff;
    }

    .sort {
        line-height: 24px;
    }

    .dataList li {
        line-height: 2em;
    }

    .dataList li:hover {
        background: #ddd;
    }


        .myPrecautions, .textlist {
            margin: 10px;
        }

        .textlist {
            width: 98%;
            max-width: 1440px;
        }

        .textlist>div {
            margin: 10px 0 20px;
        }

        .textlist>div>div {
            box-sizing: border-box;
        }

        .textEdit {
            border: 1px dotted #00000033;
            min-height: 3em;
            padding: 10px;
            margin-top: 10px;
        }

        .textEdit .tip {
            display: block;
        }

        .textlist button {
            margin: 5px 0;
            padding: 0 5px;
            border: 1px solid #9e9e9e;
            border-radius: 5px;
            background: #4caf50;
            color: #fff;
        }

        .textlist .addhtmlButton {
            display: flex;
        }

        .textlist .reset_allchange {
            min-width: 105px;
            margin-right: 10px;
        }

        .textlist .reset_allchange>div {
            margin: 10px 0 0 10px;
        }

        .textlist .resetAddhtml,
        .textlist .resetsubmit,
        .textlist .resetpreview {
            background: #607d8bd4;
        }

        .textlist .deleteAddhtml {
            background: #9e9e9e;
        }

        .textlist .listpreview .textli {
            color: #666666;
            font-size: 14.95px;
            font-family: Gotham, Roboto, Arial, Helvetica, sans-serif;
        }

        .textli>h2 {
            font-weight: bold;
            margin-top: 1em;
            line-height: 1em;
        }

        .textli>p {
            /* font-size: 120%; */
            margin: 0.8em 0;
            line-height: 1.8em;
        }

        .textli>ul>li {
            line-height: 2em;
            font-size: 110%;
            list-style: circle inside;
        }

        input[type="checkbox"] {
            float: left;
            position: relative;
            width: 18px;
            height: 18px;
            margin: 1px 18px 1px 0px
        }

        input[type="checkbox"]:after {
            content: '';
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            width: 16px;
            height: 16px;
            border: 1px solid #9e9e9e;
            background: white;
            box-sizing: content-box;
        }

        input[type="checkbox"]:checked:after {
            content: '\2713';
            font-weight: bold;
            color: #fff;
            background: #4caf50;
        }

        .textarea,
        .list {
            width: 100%;
            min-height: 3em;
            _height: 3em;
            margin-left: auto;
            margin-right: auto;
            padding: 3px;
            outline: 0;
            font-size: 12px;
            word-wrap: break-word;
            overflow-x: hidden;
            overflow-y: hidden;
            /*-webkit-user-modify: read-write-plaintext-only;*/
            border: 1px solid #767676;
            white-space: pre-line;
        }

        textarea::-webkit-input-placeholder {
            /* WebKit browsers */
            color: rgba(158,158,158,0.7);
        }
        textarea:-moz-placeholder {
            /* Mozilla Firefox 4 to 18 */
            color: rgba(158,158,158,0.7);
        }
        textarea::-moz-placeholder {
            /* Mozilla Firefox 19+ */
            color: rgba(158,158,158,0.7);
        }
        textarea::-ms-input-placeholder {
            /* Internet Explorer 10+ */
            color: rgba(158,158,158,0.7);
        }

        .relatetip {
            width: 3em;
        }
        /*
        .relate {
            display: inline-block;
            width: 15%;
            min-height: 2em;
            _height: 3em;
            margin-left: auto;
            margin-right: auto;
            padding: 3px;
            outline: 0;
            font-size: 12px;
            word-wrap: break-word;
            overflow-x: hidden;
            overflow-y: auto;
            -webkit-user-modify: read-write-plaintext-only;
            border: 1px solid #767676;
        }

        div[contenteditable]:empty:before {
            content: attr(placeholder);
            color: rgba(158,158,158,0.7);
        }

        div[contenteditable]:focus {
            content: none;
        }
        */
        .textlist button.tab {
            border-radius: 0;
            background: #fff;
            color: #000;
            border: none;
            font-weight: 700;
        }

        .textlist button.tab:hover,
        .textlist .tab.active {
            color: #4caf50;
        }

        .textlist .tab.active {
            border-bottom: 3px solid #4caf50;
        }

        .textlist .addpdetail, .textlist .addbuyPoint {
            background: #009688;
        }

        .textlist .addhtmlbtn {
            color: inherit;
            background: #fff;
            font-weight: bold;
            border: 1px dashed;
        }

        .textlist .textli {
            max-width: 1080px;
            margin: auto;
            padding: 20px;
            font-size: 115%;
            line-height: 30px;
        }

        .textlist .listpreview .textli img {
            width: 100%;
        }

        .textlist .listpreview .textli li {
            list-style: circle outside;
            margin-left: 20px;
            width: calc(100% - 20px);
            padding: 0 5px;
        }

        .textlist .listpreview .textli h1 {
            font-size: 160%;
            font-weight: 550;
            padding: 20px 0 10px 0;
            margin-bottom: 0;
        }

        .textlist .listpreview .textli h2 {
            font-size: 130%;
            font-weight: 550;
            padding: 10px 0 0 0;
        }

        .textlist .listpreview .textli p {
            margin: 0;
            line-height: 2em;
            padding: 0 0 10px 0;
        }

        .textlist .listpreview .textli ul {
            padding: 10px 0;
        }

        .textlist .listpreview .textli .specifics_product {
            display: inline-block;
            width: calc(100% + 40px);
            height: auto;
            margin-left: -20px;
            padding: 10px 20px;
            color: #615e53;
            background: #f5f0da59;
        }

        .textlist .listpreview .textli .specifics_product ul{
            column-count: 2;
        }

        .textlist .listpreview .textli .pr-note {
            margin-bottom: 20px;
        }

        .textlist .listpreview .textli .pr-note p {
            padding-bottom: 0;
        }

        .textlist .listpreview .textli .pr-note .strong {
            color: red;
            font-weight: bold;
        }

        .textlist .listpreview .textli .pr-relate {
            text-align: center;
            margin-top: 20px;
        }

        .textlist .listpreview .textli .pr-relate h3 {
            font-size: 120%;
            font-weight: 500;
            margin: 10px 0;
            color: #222;
        }

        .textlist .decrease,.textlist .increase {
            font-weight: bold;
            color: #7b939f;
            background: #fff;
            margin-right: 10px;
        }

        .textarea.border-0 {
            width: 101.3%;
            display: flex;
            flex-wrap: wrap;
        }

        .textarea>div {
            display: flex;
            padding-bottom: 10px;
            width: calc(100% - 3em);
        }

        .textarea>div>textarea {
            flex: 1;
            min-height: 2em;
            height: 2em;
            margin-right: 1%;
            padding: 3px;
            font-size: 12px;
            word-wrap: break-word;
            overflow-x: hidden;
            overflow-y: hidden;
            border: 1px solid #767676;
        }

        .textarea>div>div:last-of-type {
            margin-right: 0;
        }
    </style>
    <script>
        /*注意事项*/
        $(".morecontent").css("display", "none");
        $(".viewmore").click(function(){
            $(".morecontent").toggle();
            $(".viewmore").toggle();
        });
        $(".morecontent").click(function(){
            $(".morecontent").toggle();
            $(".viewmore").toggle();
        });

        /*tab选项卡*/
        var tab = [".buyPointbtn", ".detailbtn", ".normalbtn"];
        var buttonbox = [".buyPointhtml", ".detailhtml", ".normalhtml"];
        var textEdit = ["#textEdit1", "#textEdit2", "#textEdit3"];
        var textSub = ["#list1", "#list2", "#list3"];
        var textLi = ["#textli1", "#textli2", "#textli3"];
        var BoxArr = [buttonbox,textEdit,textSub,textLi];
        var activeClass = ["","textEdit","list","textli"];
        tabBox(tab, BoxArr, activeClass);

        /*不同选项卡的同一种 input 或 select 值保持一致*/
        sameValue(".sku1", ".sku");

        /*dataList的select用arr数组项作为option,且按字母排序；dataList对应input的值必须为其保存数据中的一项*/
        var arr1 = ['Wheel Spacers', 'Wheel Hub Bearing', 'Keyless Entry Remote', 'Ignition Coil', 'Head Gasket Set', 'AC Compressor', 'Exhaust Manifold', 'CV Axle Shaft Assembly', 'Brake Rotor And Pads', 'Timing Chain Kit', 'Timing Belt Kit', 'Power Window Regulator', 'Leveling Lift Kit', 'Thermosta Thousing', 'Water Pump', 'Radiators', 'Suspension Kit', 'Door Handle', 'Shock Absorber', 'Complete Struts', 'Fuel Pump', 'O2 Sensor', 'Lift Support', 'Sensor', 'Side Mirror', 'ABS Wheel Speed Sensor', 'Door Lock Actuator', 'Power Window Switch', 'Starter', 'Air Suspension Struts', 'Alternator', 'Radiator Cooling Fan', 'Brake Caliper', 'Fasteners'];

        dataListValue(arr1,"sort");

        /*addbuyPoint按钮：添加产品买点信息*/
        $(".addbuyPoint").click(function () {
            if ($(".textEdit").find(".editItem").length == 0) {
                $(".addli").click();
            }
        });

        /*addpdetail按钮：添加产品细节信息*/
        $(".addpdetail").click(function () {
            var EditItem = $(".textEdit").find(".editItem");
            var Sku = $(".addhtmlButton").find(".sku");
            var Sort = $(".addhtmlButton").find('[list="sort"]');
            if (EditItem.length == 0) {
                if (Sku.val().replace(/\s/g, "") != '' && Sort.val().replace(/\s/g, "") != '') {
                    $(".addmainimg").click();
                    $(".addh1").eq(0).click();
                    $(".addp").eq(0).click();
                    $(".addh2").eq(0).click();
                    $(".addli").eq(0).click();
                    $(".addnotep").eq(0).click();
                    $(".addspecificsh2").eq(0).click();
                    $(".addspecificslispan").eq(0).click();
                    $(".addrelate").eq(0).click();

                    var EditItem = $(".textEdit").find(".editItem");
                    EditItem.eq(1).find(".textarea").attr("placeholder", "产品名称");
                    EditItem.eq(2).find(".textarea").attr("placeholder", "产品描述");
                    EditItem.eq(3).find(".textarea").text("Features");
                    EditItem.eq(3).find(".textarea").attr("disabled","disabled");
                    EditItem.eq(4).find(".textarea").attr("placeholder", "产品的Features");
                    EditItem.eq(5).find(".textarea").text("1.\n2.");
                    EditItem.eq(6).find(".textarea").text("Product Specifics");
                    EditItem.eq(6).find(".textarea").attr("disabled","disabled");
                    EditItem.eq(7).find(".textarea").attr("placeholder", "Specifics名: Specifics值");
                }
            }
        });

        /*addpdetail,addbuyPoint：增加自定义*/
        $(".addhtmlbtn").click(function(){
            $(".normalhtml").css("display","");
            $(".sku1").css("display","none");
            $(".addhtmlbtn").css("display","none");
        });

        /*添加各种html标签的编辑框*/
        Addhtml(".addh1", "h1");
        Addhtml(".addh2", "h2");
        Addhtml(".addp", "p");
        Addhtml(".addli", "li");
        Addhtml(".addlispan", "li", "span");
        Addhtml(".addspecificsh2", "h2", "", "specifics");
        Addhtml(".addspecificslispan", "li", "span", "specifics");
        Addhtml(".addnotep", "p", "", "note");
        Addhtml(".addother", "other");
        Addhtml(".addmainimg", "mainimg");
        Addhtml(".addrelate","relate");
        Addhtml(".addimg","img");

        /*点击submit，将文本转换为html结构*/
        textChangehtml(false);

        /***页面滚动在指定范围时浮动按钮***/
        // 防止抖动
        function debounce(fn, wait) {
            var timeout = null;
            return function () {
                if (timeout !== null)
                    clearTimeout(timeout);
                timeout = setTimeout(fn, wait);
            }
        }
        // 处理函数
        function handle() {
            editbuttonFixed(".addhtmlButton", ".textEdit", ".listEdit");
            editbuttonFixed(".submitButton", ".list", ".listsubmit");
            editbuttonFixed(".previewButton", ".textli", ".listpreview");
        }
        // 滚动事件
        window.addEventListener('scroll', debounce(handle, 50));

        /*清除编辑框内容*/
        Clean(".list", ".resetsubmit");
        Clean(".textli", ".resetpreview");
        /*清除编辑框选中的每一项*/
        allchangeReset(".deleteAddhtml", ".resetAddhtml", ".allchange", ".itemchecked", ".textEdit");

        /*拖动编辑框排序*/
        var elArr = ['textEdit3'];
        sortableEdit(elArr);

        /**********************************实现方法**************************************************/

        /***************************Addhtml(增加对应html标签的文本编辑框)***************************/
        /**
             * addhtml:addhtml按钮的类名，label：html标签名,
             * mark:列表每一项中第一个冒号前面的所有内容加上span标签,
             * box:连续点击有相同box的按钮，会给这些项外层套一个容器
        **/
        function Addhtml(addhtml, label, mark, box) {
            /*
                textlist:整体容器的类名，  textEdit：增加对应html结构的编辑框的容器
                addhtmlButton:增加对应编辑框按钮，allchange:全选
                sku: sku输入框，imgalt:imgalt输入框，imgname:imgname输入框
            */
            var textlist = ".textlist";
            var textEdit = ".textEdit";
            var addhtmlButton = ".addhtmlButton";
            var allchange = ".allchange";
            var sku = ".sku";
            var sort = '[list="sort"]';
            $(textlist).each(function () {
                var Textlist = $(this);
                var Addhtml = Textlist.find(addhtml);

                Addhtml.click(function () {
                    var TextEdit = Textlist.find(textEdit);
                    var AddhtmlButton = Textlist.find(addhtmlButton);
                    var Allchange = $(allchange);
                    var Sku = Textlist.find(sku);
                    var Sort = Textlist.find(sort);

                    if ($(this).attr("class") == "addmainimg") {
                        if (Sku.val().replace(/\s/g, "") != '' && Sort.val().replace(/\s/g, "") != '') {
                            var creatitem = createdititem($(this), AddhtmlButton, TextEdit, label, Allchange);
                            creatitem.Textarea.attr("placeholder", "product detail 的主图描述信息");
                            autoTextarea($(creatitem.Textarea)[0], 20);
                        }
                    } else if ($(this).attr("class") == "addimg") {
                        var creatitem = createdititem($(this), AddhtmlButton, TextEdit, label, Allchange);
                        var arr = ["alt", "name"];
                        relateN(1, arr, creatitem.Textarea, false);
                        creatitem.Textarea.find(".relatename").children().attr("placeholder", "图片名(eg: 001.jpg)");
                        $.each(creatitem.Textarea.find("textarea"),function(i,n){
                            autoTextarea($(n)[0], 20);
                        });
                    } else if ($(this).attr("class") == "addrelate") {
                        if (Sku.val().replace(/\s/g, "") != '' && Sort.val().replace(/\s/g, "") != '') {
                            var creatitem = createdititem($(this), AddhtmlButton, TextEdit, label, Allchange);
                            var arr = ["alt", "h3", "p"];
                            relateN(4, arr, creatitem.Textarea, true);
                            creatitem.Textarea.find(".relatealt").children().attr("placeholder", "相关内容的图片描述信息");
                            $.each(creatitem.Textarea.find("textarea"),function(i,n){
                                autoTextarea($(n)[0], 20);
                            });
                        }
                    } else {
                        var creatitem = createdititem($(this), AddhtmlButton, TextEdit, label, Allchange);
                        autoTextarea($(creatitem.Textarea)[0], 20);
                        if (mark && (mark.replace(/\s*/g, "") != "")) {
                            creatitem.Textarea.data("Mark", mark);
                        }
                        if (box && (box.replace(/\s*/g, "") != "")) {
                            creatitem.Textarea.data("Box", box);
                        }
                    }

                    function createdititem(Addhtml, AddhtmlButton, TextEdit, label, Allchange) {
                        /*创建一个编辑框容器*/
                        var editItem = document.createElement("div");
                        editItem.className = "editItem";
                        TextEdit.append(editItem);
                        var EditItem = TextEdit.find(editItem);

                        /*创建多选框*/
                        var itemchecked = document.createElement("input");
                        itemchecked.type = "checkbox";
                        itemchecked.className = "itemchecked";
                        EditItem.append(itemchecked);
                        /*每次新增编辑框时，取消多选*/
                        if (Allchange.prop("checked") == true) {
                            Allchange.prop("checked", false);
                        }

                        /*创建编辑框提示*/
                        var tip = document.createElement("span");
                        tip.className = "tip";
                        EditItem.append(tip);
                        var Tip = EditItem.find(tip);
                        Tip.text(Addhtml.text() + ":");

                        /*创建编辑框*/
                        if(label == "relate" || label == "img"){
                            var Label = document.createElement("div");
                            Label.className = "textarea border-0";
                        }else{
                            var Label = document.createElement("textarea");
                            Label.className = "textarea";
                        }

                        EditItem.append(Label);
                        EditItem.append("<br>");
                        var Textarea = EditItem.find(Label);
                        Textarea.data("Lab", label);

                        /*滚动到最后新增html编辑框的位置*/
                        window.scrollTo({
                            top: EditItem.offset().top - parseFloat(AddhtmlButton.css("height")) - 5,
                            behavior: "instant"
                        });

                        return {
                            Textarea: Textarea,
                            Label: Label
                        };
                    }
                });
            });
        }

        /*************textChangehtml(转换文本为对应html代码并预览网页实际显示效果)*************/
        /**
             * 点击submit,转换文本为html
             * 点击preview，预览html结构的实际显示效果
        **/
        function textChangehtml(chineseFlag) {
            /*
                textlist:整体容器的类名，  textEdit：增加对应html结构的编辑框的容器
                submit：提交按钮的类名，  list：textarea转换的html结构，
                preview：预览按钮的类名， textli：list的实际效果
            */
            var submit = ".submit";
            var list = ".list";
            var preview = ".preview";
            var textli = ".textli";

            var textlist = ".textlist";
            var textEdit = ".textEdit";
            var sku = ".sku";
            $(textlist).each(function () {
                var Textlist = $(this);

                /*submit：转换文本为html*/
                var Submit = Textlist.find(submit);
                Submit.click(function () {
                    var Sku = Textlist.find(".sku");
                    var Sku1 = Textlist.find(".sku1");
                    var Sort = Textlist.find('[list="sort"]');
                    var List = Textlist.find(list);
                    if((Sku.val().replace(/s*/g,"")!="")&&(Sort.val().replace(/s*/g,"")!="")){
                        if(Sku.css("border-color")=="rgb(255, 0, 0)"){
                            Sku.css("border-color","");
                        }
                        if(Sort.css("border-color")=="rgb(255, 0, 0)"){
                            Sort.css("border-color","");
                        }

                        var TextEdit = $(Textlist).find(textEdit);
                        var textstr = "";
                        var speindex = 0;
                        var notindex = 0;
                        var imgindex = 0;

                        var relateIndex = 0;
                        var mainimgIndex = 1;
                        var mainimgIndex1 = 0;

                        var EditItem = TextEdit.find(".editItem");
                        EditItem.each(function () {
                            var Textarea = $(this).find(".textarea");
                            var str = "";
                            var relateArr = ["alt", "h3", "p"];

                            if (Textarea.data("Lab") == "mainimg") {
                                if((mainimgIndex1==0)||(Textarea.val().replace(/\s*/g,"")!="")){
                                    str = '<img src="{{media url="wysiwyg/products-images/'+Sort.val().replace(/\s+/g, "_")+'/'
                                        + Sku.val().trim().replace(/\s+/g, " ") + '-main-' + mainimgIndex + '.jpg"}}" alt="'
                                        + escapeHtml(Textarea.val().trim().replace(/\s+/g, " "))
                                        + '" />';
                                    mainimgIndex++;
                                }
                                if(mainimgIndex1==0){
                                    mainimgIndex1++;
                                }
                            } else if (Textarea.data("Lab") == "relate") {
                                var relateLen = Textarea.find(".relate"+relateArr[0]).children().length;
                                var stN = relatetext(relateLen, relateArr, Textarea);
                                if (stN.replace(/\s/g, "") != '') {
                                    str = ActualRelateN(relateLen, relateArr, Textarea, Sku, Sort);
                                    if(relateIndex>0){
                                        var reg ="/"+ Sku.val() + "-r-0";
                                        var replaceReg ="/"+  Sku.val() + "-r-" + relateIndex;
                                        str = str.replace(new RegExp(reg,'g'),replaceReg);
                                    }
                                    relateIndex++;
                                }
                            } else if (Textarea.data("Lab") == "img") {
                                str = '<img src="{{media url="wysiwyg/products-images/'+Sort.val().replace(/\s+/g, "_")+'/'
                                    + Textarea.find(".name_1").text().trim().replace(/\s+/g, " ") + '"}}" alt="'
                                    + escapeHtml(Textarea.find(".alt_1").text().trim().replace(/\s+/g, " "))
                                    + '" />';
                            } else {
                                str = Textarea.val();
                            }

                            if (str.replace(/\s*/g, "") != '') {
                                if((chineseFlag==false) && hasChinese(str)){
                                    Textarea.prev().css("color","red");
                                    textstr = textstr + str;
                                    return;
                                }else{
                                    Textarea.prev().css("color","");
                                }
                                var arr = [];
                                var wrapLab = ["mainimg", "other", "relate", "img"];
                                if (wrapLab.indexOf(Textarea.data("Lab")) != -1) {
                                    arr[0] = str + "\n";
                                } else {
                                    str = str.replace(/\r\n/g, "\n");
                                    arr = str.split("\n");
                                    var len = arr.length;
                                    for (var j = 0; j < len; j++) {
                                        arr[j] = arr[j].trim().replace(/\s+/g, " ");
                                        if (arr[j].replace(/\s/g, "") != '') {
                                            if (Textarea.data("Mark") == "span") {
                                                arr[j] = arr[j].toString();
                                                if(arr[j].indexOf(":")!=-1){
                                                    arr[j] = "<span>" + arr[j].slice(0,arr[j].indexOf(":")).trim() + ": </span>" + arr[j].slice(arr[j].indexOf(":") + 1).trim();
                                                }else if(arr[j].indexOf("：")!=-1){
                                                    arr[j] = "<span>" + arr[j].slice(0,arr[j].indexOf("：")).trim() + ": </span>" + arr[j].slice(arr[j].indexOf("：") + 1).trim();
                                                }
                                            }
                                            if (Textarea.data("Lab") == "li") {
                                                arr[j] = "    <" + Textarea.data("Lab") + ">" + arr[j] + "</"
                                                    + Textarea.data("Lab") + ">" + '\n';
                                            } else {
                                                arr[j] = "<" + Textarea.data("Lab") + ">" + arr[j] + "</"
                                                    + Textarea.data("Lab") + ">" + '\n';
                                            }
                                        }
                                    }


                                    if (Textarea.data("Box") == "specifics") {
                                        for (var b = 0; b < arr.length; b++) {
                                            if (arr[b].replace(/\s/g, "") != '') {
                                                arr[b] = "    " + arr[b];
                                            }
                                        }
                                        if (Textarea.data("Lab") == "li") {
                                            arr[0] = "    <ul>" + '\n' + arr[0];
                                            arr[arr.length - 1] = arr[arr.length - 1] +
                                                "    </ul>" + '\n';
                                        }
                                        if (speindex == 0) {
                                            arr[0] = '<div class="specifics_product">' + '\n' + arr[0];
                                            arr[arr.length - 1] = arr[arr.length - 1] + '</div>' + '\n';
                                            speindex = 1;
                                        } else {
                                            textstr = textstr.substr(0, textstr.length - 7);
                                            arr[arr.length - 1] = arr[arr.length - 1] + '</div>' + '\n';
                                        }
                                    } else {
                                        speindex = 0;
                                        if (Textarea.data("Lab") == "li") {
                                            arr[0] = "<ul>" + '\n' + arr[0];
                                            arr[arr.length - 1] = arr[arr.length - 1] +
                                                "</ul>" + '\n';
                                        }
                                    }

                                    if (Textarea.data("Box") == "note") {
                                        for (var b = 0; b < arr.length; b++) {
                                            if (arr[b].replace(/\s/g, "") != '') {
                                                arr[b] = "    " + arr[b];
                                            }
                                        }
                                        if (notindex == 0) {
                                            arr[0] = '<div class="pr-note"> \n    <p class="strong">Note:</p>' + '\n' + arr[0];
                                            arr[arr.length - 1] = arr[arr.length - 1] + '</div>' + '\n';
                                            notindex = 1;
                                        } else {
                                            textstr = textstr.substr(0, textstr.length - 7);
                                            arr[arr.length - 1] = arr[arr.length - 1] + '</div>' + '\n';
                                        }
                                    } else {
                                        notindex = 0;
                                    }
                                }
                                textstr = textstr + arr.join("");
                            }

                            /*查找第 num 个字符串 searchStr ，在字符串 str 中出现的位置*/
                            function findStr(str, searchStr, num) {
                                var x = str.indexOf(searchStr);
                                for (var i = 0; i < num; i++) {
                                    x = str.indexOf(searchStr, x + 1);
                                }
                                return x;
                            }
                            /*在字符串 str 的位置 findStr 后面插入字符串 newStr */
                            function insertStr(str, findStr, newStr) {
                                return str.slice(0, findStr) + newStr + str.slice(findStr);
                            }
                        });

                        if (textstr.replace(/\s*/g, "") != '') {
                            if((chineseFlag==false) && hasChinese(textstr)){
                                List.text("以上标红栏目存在中文，请检查后重新输入!");
                                List.css("color","red");
                                return;
                            }else{
                                List.css("color","");
                            }
                            List.text(textstr);
                            List.height(Number(List[0].scrollHeight +2) + 'px');
                        }else{
                            List.text("");
                        }
                    }else{
                        if(Sku.val().replace(/s*/g,"")==""){
                            Sku.css("border-color","red");
                            Sku1.css("border-color","red");
                        }
                        if(Sort.val().replace(/s*/g,"")==""){
                            Sort.css("border-color","red");
                        }
                        List.text("请检查是否输入sku号或者产品类名!");
                        List.css("color","red");
                    }
                });

                /*preview：预览html结构的实际显示效果*/
                var Preview = $(this).find(preview);
                Preview.click(function () {
                    var Textli = Textlist.find(textli);
                    var List = Textlist.find(list);
                    Textli.html("");
                    var listr = List.text();
                    if (listr.replace(/\s/g, "") != '') {
                        Textli.append(List.text().replace(/{{media url='/g,
                            "https://eccppautoparts.com/media/").replace(/{{media url="/g, "https://eccppautoparts.com/media/"));
                        Textli.css("border", "1px solid #ddd");
                    }
                });
            });
        }

        /************************************relate相关方法************************************/
        /*relateN: 点击添加 n 栏的relate编辑框*/
        function relateN(n, arr, Textarea, flag) {
            var str = "";
            for (var j = 0; j < arr.length; j++) {
                var str1 = "";
                for(var i = 1; i<n+1;i++){
                    if(arr[j] == "alt"){
                        str1 = str1+ "<textarea placeholder='图片描述信息' class='"+arr[j]+"_"+i+"'></textarea>";
                    }else{
                        str1 = str1+ "<textarea class='"+arr[j]+"_"+i+"'></textarea>";
                    }
                }
                str = str + "<span class='relatetip'>" + arr[j]+ ":</span><div class = 'relate"+arr[j]+"'>"+str1+"</div>";
            }
            if(flag == true){
                str = str + "<button class='decrease'>-</button><button class='increase'>+</button>";
                Textarea.html(str);
                relateAddDel(n, arr, Textarea, ".increase", ".decrease");
            }else{
                Textarea.html(str);
            }
        }

        /*relateAddDel: 增加删除一栏relate编辑框*/
        function relateAddDel(n, arr, Textarea, increase, decrease) {
            $(Textarea).find(increase).click(function () {
                var relateLen = $(Textarea).find(".relate"+arr[0]).children().length;
                if(relateLen < n){
                    for (var j = 0; j < arr.length; j++) {
                        if(arr[j] == "alt"){
                            $(Textarea).find(".relate"+arr[j]).append("<textarea placeholder='相关内容的图片描述信息' class='"+arr[j]+"_"+Number(relateLen+1)+"'></textarea>");
                        }else{
                            $(Textarea).find(".relate"+arr[j]).append("<textarea class='"+arr[j]+"_"+Number(relateLen+1)+"'></textarea>");
                        }
                    }
                    $.each($(Textarea).find("textarea"),function(i,n){
                        autoTextarea($(n)[0], 20);
                    });
                }
             });
             $(Textarea).find(decrease).click(function () {
                var relateLen = $(Textarea).find(".relate"+arr[0]).children().length;
                if(relateLen>1){
                    for (var j = 0; j < arr.length; j++) {
                        $(Textarea).find(".relate"+arr[j]).children().last().remove();
                    }
                }
             });
        }

        /*relatetext:统计relate编辑框实际输入的所有值，判断输入是否为空*/
        function relatetext(n, arr, Textarea) {
            var textstr = "";
            for (var i = 1; i < n + 1; i++) {
                for (var j = 0; j < arr.length; j++) {
                    textstr = textstr + Textarea.find('.' + arr[j] + '_' + i).val().replace(/\s/g, "");
                }
            }
            return textstr;
        }

        /*ActualRelateN：当每一栏的alt或h3或p不为空时候，转换relate编辑框为对应html代码*/
        function ActualRelateN(n, arr, Textarea, Sku, Sort) {
            var rIndex = 0;
            var col = [];
            var start = 5;
            var startIndex = 1;

            for (var i = 1; i < n + 1; i++) {
                var str = "";
                for (var j = 0; j < arr.length; j++) {
                    str = str + Textarea.find("." + arr[j] + "_" + i).val().trim();
                }
                if(str != ""){
                    rIndex = rIndex + 1;
                    if(startIndex == 1){
                        start = i;
                        startIndex++;
                    }
                }
            }

            if(rIndex == 1){
                col = ["lg-12", "md-12", "xs-12"];
            }else if(rIndex == 2){
                col = ["lg-6", "md-6", "xs-12"];
            }else if(rIndex == 3){
                col = ["lg-4", "md-4", "xs-12"];
            }else if(rIndex == 4){
                col = ["lg-3", "md-3", "sm-6", "xs-12"];
            }

            return prRelateN(start, rIndex, col, arr, Textarea, Sku, Sort);
        }

        /*prRelateN：转换relate编辑框为对应html代码*/
        function prRelateN(start, n, col, arr, Textarea, Sku, Sort) {
            var brr = [];
            var colstr = "";
            var pstr = "";

            for (var c = 0; c < col.length; c++) {
                colstr = colstr + " col-" + col[c];
            }

            for (var i = start; i < n + start; i++) {
                brr[i - 1] = "";
                for (var j = 0; j < arr.length; j++) {
                    if (arr[j] == "alt") {
                        brr[i - 1] = brr[i - 1] + '            <img src="{{media url="wysiwyg/products-images/'+Sort.val().replace(/\s+/g, "_")+'/'
                            + Sku.val().trim().replace(/\s+/g, " ") + '-r-0' + i + '.jpg"}}" alt="'
                            + Textarea.find("." + arr[j] + "_" + i).val().trim().replace(/\s+/g, " ") + '" /> \n ';
                    } else {
                        if(arr[j] == "p"){
                            var trr = Textarea.find("." + arr[j] + "_" + i).val().trim().split("\n");
                            var tStr = "";
                            for(var t=0;t<trr.length;t++){
                                if(trr[t].replace(/\s/g,"")!=""){
                                    tStr = tStr + '            <'  + arr[j] + '>' + trr[t].replace(/\s+/g, " ") + '</' + arr[j] + '> \n ';
                                }
                            }
                            brr[i - 1] = brr[i - 1] + tStr;
                        }else{
                            brr[i - 1] = brr[i - 1] + '            <' + arr[j] + '>' + Textarea.find("." + arr[j] + "_" + i).val().trim().replace(/\s+/g, " ") + '</' + arr[j] + '> \n ';
                        }
                    }
                }
                pstr = pstr + '        <div class="' + colstr + '"> \n ' + brr[i - 1] + '        </div> \n';
            }
            pstr = '<div class="pr-relate"> \n    <div class="row"> \n' + pstr + '    </div> \n </div>';
            return pstr;
        }

        /********************************clean(清空对应选择器)********************************/
        /**
        selector:被取消选择器， button:取消此选择器的按钮
        */
        function Clean(selector, button) {
            var textlist = ".textlist";
            $(textlist).each(function () {
                var textList = $(this);
                var Clean = $(this).find(button);
                Clean.click(function () {
                    var Selector = textList.find(selector);
                    var selectorStr = Selector.text();
                    if ((selectorStr != "") && (confirm("确认清空") == true)) {
                        Selector.text("");
                    } else {
                        selectorStr = Selector.html();
                        if ((selectorStr != "") && (confirm("确认清空") == true)) {
                            Selector.html("");
                        }
                    }
                    /*清空 preview 的样式*/
                    if ($(this).attr("class") == "resetpreview") {
                        Selector.removeAttr("style");
                    }
                });
            });
        }

        /************************************allchange相关方法************************************/
        /**
         * 点击allchange按钮全选checkbox，再点击checkbox取消全选；
         * 点击reset按钮清空选中checkbox的内容；
         * 点击delete按钮删除选中checkbox；
         * checkContainer：checkbox的容器
        **/
        function allchangeReset(delet, reset, allchange, checkbox, checkContainer) {
            $(checkContainer).each(function () {
                var CheckContainer = $(this);
                var Allchange = $(allchange);
                var Delet = $(delet);
                var Reset = $(reset);

                Allchange.click(function () {
                    var CheckContainer = $(checkContainer);
                    var Checkbox = CheckContainer.find(checkbox);
                    if (Checkbox.length > 0) {
                        var allchange_Checked = $(this).prop("checked");
                        Checkbox.each(function () {
                            if ($(this).prop("checked") != allchange_Checked) {
                                $(this).prop("checked", allchange_Checked);
                            }
                        });

                        Checkbox.click(function () {
                            if (($(this).prop("checked") != true) && (Allchange.prop("checked") == true)) {
                                Allchange.prop("checked", false);
                            }
                        });
                    }
                });
                /*delete Addhtml: 删除选中的checkbox*/
                Delet.click(function () {
                    var CheckContainer = $(checkContainer);
                    var Checkbox = CheckContainer.find(checkbox);
                    if (Checkbox.length > 0) {
                        var cindex = 0;
                        if (Allchange.prop("checked") == true) {
                            if (confirm("确认删除") == true) {
                                Allchange.prop("checked", false);
                                CheckContainer.html("");
                            }
                        } else {
                            Checkbox.each(function () {
                                if ($(this).prop("checked") == true) {
                                    if (cindex == 0) {
                                        if (confirm("确认删除") == true) {
                                            $(this).parent().remove();
                                        } else {
                                            return false;
                                        }
                                        cindex = 1;
                                    } else {
                                        $(this).parent().remove();
                                    }
                                }
                            });
                        }
                    }
                });

                /*reset Addhtml: 清空选中的checkbox*/
                Reset.click(function () {
                    var CheckContainer = $(checkContainer);
                    var Checkbox = CheckContainer.find(checkbox);
                    if (Checkbox.length > 0) {
                        var cindex = 0;
                        if (Allchange.prop("checked") == true) {
                            if (confirm("确认清空") == true) {
                                Allchange.prop("checked", false);
                                Checkbox.prop("checked", false);
                                Checkbox.parent().find('[contenteditable="true"]').text("");
                            }
                        } else {
                            Checkbox.each(function () {
                                if ($(this).prop("checked") == true) {
                                    if (cindex == 0) {
                                        if (confirm("确认清空") == true) {
                                            $(this).prop("checked", false);
                                            $(this).parent().find('[contenteditable="true"]').text("");
                                        } else {
                                            return false;
                                        }
                                        cindex = 1;
                                    } else {
                                        $(this).prop("checked", false);
                                        $(this).parent().find('[contenteditable="true"]').text("");
                                    }
                                }
                            });
                        }
                    }
                });
            });
        }

        /*******************************editbuttonFixed（浮动按钮）*******************************/
        /**
         * editbutton 在 textedit的范围类浮动
        **/
        function editbuttonFixed(editbutton, textedit, box) {
            $(box).each(function () {
                var Box = $(this);
                var EditButton = $(this).find(editbutton);
                var TextEdit = $(this).find(textedit);
                EditButton.css("width", TextEdit.css("width"));
                EditButton.css("background-color", "#fff");
                if (parseFloat(TextEdit.css("height")) > parseFloat(EditButton.css("height")) * 2) {
                    var startpos = parseFloat(TextEdit.offset().top);
                    var endpos = parseFloat(TextEdit.offset().top) +
                        parseFloat(TextEdit.css("height")) - parseFloat(EditButton.css("height"));

                    var scrollTop = $(document).scrollTop();
                    if (scrollTop > endpos || scrollTop < startpos) {
                        EditButton.css("position", "");
                        EditButton.css("top", "");
                        EditButton.css("z-index", "");
                        EditButton.css("box-shadow", "");
                    } else {
                        EditButton.css("position", "fixed");
                        EditButton.css("top", "0");
                        EditButton.css("z-index", "2");
                        EditButton.css("box-shadow", "#767676 0px 0px 10px 5px");
                    }
                } else {
                    EditButton.css("position", "");
                    EditButton.css("top", "");
                    EditButton.css("z-index", "");
                    EditButton.css("box-shadow", "");
                }
            })
        }

        /****************************************字符转义****************************************/
        function escapeHtml(string) {
            var entityMap = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#39;',
                '/': '&#x2F;',
                '`': '&#x60;',
                '=': '&#x3D;'
            };
            return String(string).replace(/[&<>"'`=\/]/g, function (s) {
                return entityMap[s];
            });
        }

        /***********************************识别字符串是否含有中文***********************************/
        function hasChinese(str) {
            if (/.*[\u4e00-\u9fa5]+.*/.test(str)) {
                return true;
            } else {
                return false;
            }
        }

        /****************************************拖动排序****************************************/
        function sortableEdit(elId) {
            for (var e = 0; e < elId.length; e++) {
                var el = [];
                var sortable = [];
                el[e] = document.getElementById(elId[e]);
                sortable[e] = Sortable.create(el[e], {
                    animation: 150,
                });
            }
        }

        /****************************************tab选项卡方法****************************************/
        /**
         * tab：选项卡选择按钮
         * BoxArr: 选项卡选择的各个容器
         * activeClass：选项卡选择对应容器时，该容器增加对应类名，此时该容器显示并通过此类名调用对应方法
         **/
         function tabBox(tab, BoxArr, activeClass) {
             //初始化tab按钮
            $(tab[0]).addClass("active");

            //初始化各个BoxArr容器
            for(var i = 0; i<BoxArr.length; i++){
                $(BoxArr[i][0]).addClass(activeClass[i]);
                for(var j = 1; j<BoxArr[i].length; j++){
                    $(BoxArr[i][j]).css("display","none");
                }
            }

            for(var t=0; t<tab.length; t++){
                $(tab[t]).click(function () {
                    var e = $(this).index();

                    if($(BoxArr[0][e]).find(".addhtmlbtn").css("display")=="none"){
                        $(BoxArr[0][e]).find(".addhtmlbtn").css("display","");
                        $(".normalhtml").css("display","none");
                        if(BoxArr[0][e] == ".detailhtml"){
                            $(".sku1").css("display","");
                        }
                    }

                    if($(this).hasClass("active")==false){
                        //点击tab按钮，增加此按钮的"active"类名，移除其他tab按钮的"active"类名
                        $(this).siblings().removeClass("active");
                        $(this).addClass("active");

                        //点击tab按钮，控制对应的BoxArr容器的显隐，增删对应activeClass类名
                        for(var s = 0; s<BoxArr.length; s++){
                            $(BoxArr[s][e]).siblings().removeClass(activeClass[s]);
                            $(BoxArr[s][e]).addClass(activeClass[s]);
                            $(BoxArr[s][e]).css("display","");
                            for(var r = 0; r<BoxArr[s].length; r++){
                                if(r != e){
                                    $(BoxArr[s][r]).css("display","none");
                                }
                            }
                        }
                    }
                });
            }
         }

        /*不同选项卡的同一种 input 或 select 值保持一致的方法*/
        function sameValue(a, b) {
            $(a).bind("input propertychange", function () {
                $(b).val($(this).val());
            });
            $(b).bind("input propertychange", function () {
                $(a).val($(this).val());
            });
        }

        /*使用arr数组项并按字母排序作为dataList的保存数据；input输入值必须存在于对应dataList保存数据中*/
        function dataListValue(arr, ele) {
            arr.sort(function (s1, s2) {
                x1 = s1.toUpperCase();
                x2 = s2.toUpperCase();
                if (x1 < x2) {
                return -1;
                }
                if (x1 > x2) {
                return 1;
                }
                return 0;
            });

            var temp = "<li>AutoParts</li>";
            for (var i in arr) {
                temp += "<li value=" + arr[i].trim().replace(/\s+/g,"_") + ">" + arr[i].trim().replace(/\s+/g," ") + "</li>";
            }
            $("<ul class='dataList'>" + temp + "</ul>").insertAfter("." + ele);

            $("." + ele).on("input propertychange", function () {
                $(this).next().css("display", "block");
                var dataList = $(this).next().children();
                for (var i = 0; i < dataList.length; i++) {
                    if (dataList.eq(i).text().toUpperCase().indexOf($(this).val().toUpperCase()) == -1) {
                        dataList.eq(i).css("display", "none");
                    } else {
                        dataList.eq(i).css("display", "");
                    }
                }
            });

            $("." + ele).blur(function(){
                if($(this).val().replace(/\s/g,"") != ""){
                    if($(".dataList li[value='"+$(this).val().replace(/\s+/g,"_")+"']").length==0){
                        $("." + ele).val("");
                        $(".dataList").css("display", "");
                        $(".dataList li").css("display", "block");
                    }
                }
            });

            $("." + ele).click(function () {
                var dis = $(this).next().css("display") == "block" ? "" : "block";
                $(this).next().css("display", dis)
            });

            $("html").click(function (e) {
                for (var k in ele) {
                if (!$(e.target).hasClass(ele)) {
                    $(".dataList").css("display", "");
                }
                }
            });

            $(".dataList li").click(function () {
                if($("." + ele).val() != $(this).text()){
                $("." + ele).val($(this).text());
                }
            });
        }

        /*******************************autoTextarea（文本框根据输入内容自适应高度）*******************************/
        /**
        * @param                {HTMLElement}           输入框元素
        * @param                {Number}                设置光标与输入框保持的距离(默认0)
        * @param                {Number}                设置最大高度(可选)
        **/
        var autoTextarea = function (elem, extra, maxHeight) {
            extra = extra || 0;
            var isFirefox = !!document.getBoxObjectFor || 'mozInnerScreenX' in window,
            isOpera = !!window.opera && !!window.opera.toString().indexOf('Opera'),
            addEvent = function(type, callback) {
                elem.addEventListener ? elem.addEventListener(type, callback, false) : elem.attachEvent('on' + type, callback);
            },
            getStyle = elem.currentStyle ?
            function(name) {
                var val = elem.currentStyle[name];

                if (name === 'height' && val.search(/px/i) !== 1) {
                    var rect = elem.getBoundingClientRect();
                    return rect.bottom - rect.top - parseFloat(getStyle('paddingTop')) - parseFloat(getStyle('paddingBottom')) + 'px';
                };

                return val;
            }: function(name) {
                return getComputedStyle(elem, null)[name];
            },
            minHeight = parseFloat(getStyle('height'));

            elem.style.resize = 'none';

            var change = function() {
                var scrollTop, height, padding = 0,
                style = elem.style;

                if (elem._length === elem.value.length) return;
                elem._length = elem.value.length;

                if (!isFirefox && !isOpera) {
                    padding = parseInt(getStyle('paddingTop')) + parseInt(getStyle('paddingBottom'));
                };
                scrollTop = document.body.scrollTop || document.documentElement.scrollTop;

                elem.style.height = minHeight + 'px';
                if (elem.scrollHeight > minHeight) {
                    if (maxHeight && elem.scrollHeight > maxHeight) {
                        height = maxHeight - padding;
                        style.overflowY = 'auto';
                    } else {
                        height = elem.scrollHeight - padding;
                        style.overflowY = 'hidden';
                    };
                    style.height = height + extra + 'px';
                    scrollTop += parseInt(style.height) - elem.currHeight;
                    document.body.scrollTop = scrollTop;
                    document.documentElement.scrollTop = scrollTop;
                    elem.currHeight = parseInt(style.height);
                };
            };

            addEvent('propertychange', change);
            addEvent('input', change);
            addEvent('focus', change);
            change();
        };

        /*textarea高度自适应*/
        $.each($("textarea"), function(i, n){
            autoTextarea($(n)[0], 20);
        });
    </script>
</body>

</html>
