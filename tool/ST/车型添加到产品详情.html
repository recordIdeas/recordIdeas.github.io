<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>车型转换工具</title>
  <script type="text/javascript" src="../../js/xlsx.core.min.js"></script>
</head>

<style>
  .btn {
    width: 1.5em;
    height: 1.5em;
    margin: 0 10px 20px 0;
  }

  .model-items {
    margin-bottom: 20px;
  }

  .model-item {
    padding-bottom: 10px;
    display: flex;
  }

  .model-item input{
    margin: 0 10px;
  }
</style>
<body>
  <div class="tabs">
    <input type="radio" name="tabs" id="tabone" checked="checked">
    <label for="tabone">车型处理</label>
    <div class="tab">
      <div class="up_btn">导入车型表：
        <input type="file" id="xFile" multiple name=""
          accept="application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
          onchange="showfile1(this,'excelFile')" onclick="this.value=''" ;>
      </div>
      <div id="excelFile">
        <table border='1'>
          <thead>
            <tr>
              <th>SKU</th>
              <th>Data</th>
              <th>product Details</th>
              <th>result</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
      <div class="export_btn">导出excel:<input type="button" OnClick="btn_export('excelFile')" value="导出" /></div>
    </div>
    <input type="radio" name="tabs" id="tabtwo">
    <label for="tabtwo">批量处理</label>
    <div class="tab">
      <div class="up_btn">导入统计表：
        <input type="file" id="xFile" name=""
          accept="application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
          onchange="showfile2(this,'totalExcel')" onclick="this.value=''" ;>
      </div>
      <div id="totalExcel">
        <table border='1'>
          <thead>
            <tr>
              <th>SKU</th>
              <th>Data</th>
              <th>product Details</th>
              <th>result</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
      <div class="export_btn">导出excel:<input type="button" OnClick="btn_export('totalExcel')" value="导出" /></div>
    </div>
    <input type="radio" name="tabs" id="tabthree">
    <label for="tabthree">特殊车型处理</label>
    <div class="tab">
      <div class="special-model">
        <button id="add-special-model" class="btn">+</button>
        <button id="del-special-model" class="btn">-</button>
        <div class="model-item">
          Make : <input type="text">
          Model: <input type="text">
        </div>
      </div>
      <div class="up_btn">导入特殊车型表：
        <input type="file" id="xFile" multiple name=""
          accept="application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
          onchange="showfile3(this,'specialExcel')" onclick="this.value=''" ;>
      </div>
      <div id="specialExcel">
        <table border='1'>
          <thead>
            <tr>
              <th>SKU</th>
              <th>Data</th>
              <th>product Details</th>
              <th>result</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
      <div class="export_btn">导出excel:<input type="button" OnClick="btn_export('specialExcel')" value="导出" /></div>
    </div>

  </div>

  <style>
    * {
      box-sizing: border-box;
      list-style: none;
      margin: 0;
      padding: 0;
    }

    textarea {
      width: 100%;
      white-space: pre-line;
      padding: 0;
      border: 0;
      height: 1em;
    }

    .export_btn {
      display: none;
    }

    table {
      width: 100%;
    }

    td {
      vertical-align: baseline;
    }

    th:nth-of-type(1),
    td:nth-of-type(1) {
      width: 5%;
    }

    th:nth-of-type(2),
    td:nth-of-type(2) {
      width: 25%;
    }

    th:nth-of-type(3),
    td:nth-of-type(3),
    th:nth-of-type(4),
    td:nth-of-type(4) {
      width: 35%;
    }

    .tabs {
      padding: 10px;
    }

    .up_btn {
      padding-bottom: 10px;
    }

    .tabs input[name="tabs"] {
      display: none;
    }

    .tabs input[name="tabs"]+label+.tab {
      display: none;
    }

    .tabs input[name="tabs"]:checked+label+.tab {
      display: block;
    }

    .tabs input[name="tabs"]:checked+label {
      border-bottom: 2px solid #444;
      margin-bottom: 5px;
      padding-bottom: 5px;
    }

    .tabs input[name="tabs"]~label:last-of-type {
      margin-right: 0;
    }

    .tabs input[name="tabs"]~label {
      margin-right: 20px;
    }

    .tabs .tab {
      position: absolute;
      margin-top: 15px;
      padding-right: 40px;
      width: 100%;
    }
  </style>

  <script>
    addItem(document.getElementById("add-special-model"),  document.querySelector(".model-item"), document.querySelector(".special-model"));
    delItem(document.getElementById("del-special-model"), ".model-item", document.querySelector(".special-model"));

    document.body.addEventListener("click", function (e) {
      var e = e || window.event;
      var target = e.target;
      if (target.className.indexOf("details-result") != -1) {
        var str2 = target.previousElementSibling.innerText;
        handleDetails(target, str2);
      }
    });

    // 读取文件的内容
    function showfile1(obj, importExcel) {
      var excelFile;
      document.getElementById(importExcel).nextElementSibling.style.display = "";
      if (!obj.files) {
        return;
      }
      document.getElementById(importExcel).querySelector("tbody").innerHTML = "";
      for (var k = 0; k < obj.files.length; k++) {
        var f = obj.files[k];
        var reader = new FileReader();
        reader.readAsBinaryString(f);
        reader.onload = function (e) {
          var data = e.target.result;
          excelFile = XLSX.read(data, {
            type: 'binary'
          });
          var headers = new Array();
          var str = XLSX.utils.sheet_to_json(excelFile.Sheets[excelFile.SheetNames[0]]);
          for (var key in str[0]) {
            headers.push(key)  //获取表头
          }

          var otherSku = str.filter(function(i){
            return i.SKU != str[0].SKU;
          })

          if(otherSku.length>0){
            document.getElementById(importExcel).nextElementSibling.style.display = "none";
            return;
          }

          str.sort(function (a, b) {
            if (a.Make === b.Make) {
              if (a.Model === b.Model) {
                return a.Year - b.Year;
              }else{
                return compareString(a.Model, b.Model);
              }
            }else{
              return compareString(a.Make, b.Make);
            }
          });

          var allStr = str[0][headers[2]] + "," + str[0][headers[3]] + "," + str[0][headers[1]];
          for (var i = 1; i < str.length; i++) {
            if (str[i]) {
              if ((str[i][headers[2]] == str[i - 1][headers[2]]) && (str[i][headers[3]] == str[i - 1][headers[3]])) {
                if (str[i][headers[1]] != str[i - 1][headers[1]]) {
                  if (str[i][headers[1]] - str[i - 1][headers[1]] == 1) {
                    if (allStr.substring(allStr.lastIndexOf("-")).length == 5) {
                      allStr = allStr.substring(0, allStr.lastIndexOf("-")+1) + str[i][headers[1]];
                    } else {
                      allStr += "-" + str[i][headers[1]];
                    }
                  } else {
                    allStr += "," + str[i][headers[1]];
                  }
                }
              } else {
                allStr += ";<br>" + str[i][headers[2]] + "," + str[i][headers[3]] + "," + str[i][headers[1]];
              }
            }
          }
          var allArr = allStr.split(";<br>");
          if(allArr.length>60){
            var allBrr = allArr;
            var maxYear = Math.max.apply(Math, str.map(function(o) {return o.Year}));
            var minYear = Math.min.apply(Math, str.map(function(o) {return o.Year}));
            var searchNum = maxYear - Math.ceil((maxYear + minYear)/2) + 3;
            var startYear = Math.ceil((maxYear + minYear)/2);
            if(searchNum>30){
              startYear = maxYear - 30;
              searchNum = 30;
            }
            sortUpdateYear(str,60,startYear,searchNum);
            var len = allArr.length > 60 ? 60 : allArr.length;
            allArr.splice(len);
            for(var a = 0; a < allArr.length; a++){
              for(var b = 0; b < allBrr.length; b++){
                if(getMake(allArr,a) == getMake(allBrr,b) && getModel(allArr,a) == getModel(allBrr,b)){
                  allArr[a] = allBrr[b];
                  break;
                }
              }
            }
          }
          yearAsBegin(allArr);

          allStr = allArr.join(";<br>");
          document.getElementById(importExcel).querySelector("tbody").innerHTML += "<tr><td>"
                + str[0][headers[0]].toString().replace(/\s/g,"").replace(/^0/,"0&nbsp;")
               + '</td><td contenteditable="true">' + allStr
              + '</td><td contenteditable="true"></td><td class="details-result" contenteditable="true"></td></tr>';

          function sortUpdateYear(str,maxLen,Year,num,flag) {
            if(num>0){
              num--;
              sortByYear(str,Year);
              if(allArr.length != maxLen){
                if(allArr.length > maxLen){
                  if(!flag){
                    Year++;
                  }else{
                    return;
                  }
                }else{
                  if(!flag){
                    flag = "del";
                  }
                  Year--;
                }
                sortUpdateYear(str,maxLen,Year,num,flag);
              }else{
                return;
              }
            }else{
              return;
            }
          }

          function sortByYear(str,Year) {
            allStr = str[0][headers[2]] + "," + str[0][headers[3]] + "," + str[0][headers[1]];
            for (var i = 1; i < str.length; i++) {
              if (str[i] && Number(str[i][headers[1]].toString())>Year) {
                if ((str[i][headers[2]] == str[i - 1][headers[2]]) && (str[i][headers[3]] == str[i - 1][headers[3]])) {
                  if (str[i][headers[1]] != str[i - 1][headers[1]]) {
                    if (str[i][headers[1]] - str[i - 1][headers[1]] == 1) {
                      if (allStr.substring(allStr.lastIndexOf("-")).length == 5) {
                        allStr = allStr.substring(0, allStr.lastIndexOf("-")+1) + str[i][headers[1]];
                      } else {
                        allStr += "-" + str[i][headers[1]];
                      }
                    } else {
                      allStr += "," + str[i][headers[1]];
                    }
                  }
                } else {
                  allStr += ";<br>" + str[i][headers[2]] + "," + str[i][headers[3]] + "," + str[i][headers[1]];
                }
              }
            }
            allArr = allStr.split(";<br>");
          }
        }
      }
      document.getElementById(importExcel).nextElementSibling.style.display = "block";
    }

    function showfile2(obj, importExcel) {
      var excelFile;
      document.getElementById(importExcel).nextElementSibling.style.display = "";
      if (!obj.files) {
        return;
      }
      var f = obj.files[0];

      var reader = new FileReader();
      reader.readAsBinaryString(f);
      reader.onload = function (e) {
        var data = e.target.result;
        excelFile = XLSX.read(data, {
          type: 'binary'
        });

        var headers = new Array();
        var str = XLSX.utils.sheet_to_json(excelFile.Sheets[excelFile.SheetNames[0]]);
        for (var key in str[0]) {
          headers.push(key)  //获取表头
        }

        var dataTable2 = "";
        for (var i = 0; i < str.length; i++) {
          if (str[i]) {
            if(str[i][headers[0]]){
              dataTable2 += "<tr><td>" + str[i][headers[0]].toString().replace(/\s/g,"").replace(/^0/,"0&nbsp;") + '</td>';
            }else{
              dataTable2 += '<tr><td></td>';
            }
            if(str[i][headers[1]]){
              dataTable2 += '<td contenteditable="true">'
              + str[i][headers[1]].replace(/\n/g, "<br>") + '</td>';
            }else{
              dataTable2 += '<td contenteditable="true"></td>';
            }
            if(str[i][headers[2]]){
              dataTable2 += '<td contenteditable="true">' + str[i][headers[2]]
              + '</td><td class="details-result" contenteditable="true"></td></tr>';
            }else{
              dataTable2 += '<td contenteditable="true"></td><td class="details-result" contenteditable="true"></td></tr>';
            }
          }
        }
        document.getElementById(importExcel).querySelector("tbody").innerHTML = dataTable2;
        var importDetals = document.getElementById(importExcel).querySelectorAll("tbody .details-result");
        for(var k=0; k<importDetals.length; k++){
          if(importDetals[k]){
            var str2 = importDetals[k].previousElementSibling.innerHTML;
            handleDetails(importDetals[k], str2);
          }
        }
      }
      document.getElementById(importExcel).nextElementSibling.style.display = "block";
    }

    // 读取文件的内容
    function showfile3(obj, importExcel) {
      var modelItems = document.querySelectorAll(".special-model .model-item");
      var filterFlag = false;
      for(var m=0; m<modelItems.length; m++){
        if(modelItems[m].getElementsByTagName("input")[0].value.trim() || modelItems[m].getElementsByTagName("input")[1].value.trim()){
          filterFlag = true;
          break;
        }
      }

      if(!filterFlag){
        showfile1(obj, importExcel);
      }else{
        var excelFile;
        document.getElementById(importExcel).nextElementSibling.style.display = "";
        if (!obj.files) {
          return;
        }
        document.getElementById(importExcel).querySelector("tbody").innerHTML = "";
        for (var k = 0; k < obj.files.length; k++) {
          var f = obj.files[k];
          var reader = new FileReader();
          reader.readAsBinaryString(f);
          reader.onload = function (e) {
            var data = e.target.result;
            excelFile = XLSX.read(data, {
              type: 'binary'
            });
            var headers = new Array();
            var str = XLSX.utils.sheet_to_json(excelFile.Sheets[excelFile.SheetNames[0]]);
            for (var key in str[0]) {
              headers.push(key)  //获取表头
            }

            var otherSku = str.find(function(i){
              return i.SKU != str[0].SKU;
            })

            if(otherSku){
              document.getElementById(importExcel).nextElementSibling.style.display = "none";
              return;
            }

            var modelItems = document.querySelectorAll(".special-model .model-item");
            var specialModelCount = [];
            for(var m=0; m<modelItems.length; m++){
              var input_Make = modelItems[m].getElementsByTagName("input")[0].value.trim().replace(/\s+/g," ").toLowerCase();
              var input_Model = modelItems[m].getElementsByTagName("input")[1].value.trim().replace(/\s+/g," ").toLowerCase();
              if(input_Make || input_Model){
                var same_Make_Model = specialModelCount.find(function(item){
                  return item.Make == input_Make && item.Model == input_Model;
                });

                if(!same_Make_Model){
                  var same_Make = specialModelCount.find(function(item){
                    return item.Make == input_Make && input_Make != "";
                  });

                  if(same_Make){
                    if(!input_Model){
                      specialModelCount = specialModelCount.filter(function(item){
                        return item.Make != input_Make;
                      });

                      specialModelCount.push({
                        Make: input_Make,
                        Model: input_Model
                      });
                    }else{
                      var empty_Model = specialModelCount.find(function(item){
                        return item.Make == input_Make && item.Model == "";
                      });

                      if(!empty_Model){
                        specialModelCount.push({
                          Make: input_Make,
                          Model: input_Model
                        });
                      }
                    }
                  }else{
                    var same_Model = specialModelCount.find(function(item){
                      return item.Model == input_Model && input_Model != "";
                    });

                    if(same_Model){
                      if(!input_Make){
                        specialModelCount = specialModelCount.filter(function(item){
                          return item.Model != input_Model;
                        });

                        specialModelCount.push({
                          Make: input_Make,
                          Model: input_Model
                        });
                      }else{
                        var empty_Make = specialModelCount.find(function(item){
                          return item.Model == input_Model && item.Make == "";
                        });

                        if(!empty_Make){
                          specialModelCount.push({
                            Make: input_Make,
                            Model: input_Model
                          });
                        }
                      }
                    }else{
                      specialModelCount.push({
                        Make: input_Make,
                        Model: input_Model
                      });
                    }
                  }
                }
              }
            }

            specialModelCount.sort(function (a, b) {
              if (a.Make === b.Make) {
                if (a.Model === b.Model) {
                  return a.Year - b.Year;
                }else{
                  return compareString(a.Model, b.Model);
                }
              }else{
                return compareString(a.Make, b.Make);
              }
            });

            str = str.filter(function(item){
              var flag = specialModelCount.find(function(obj){
                var objMake = obj.Make.toString().trim().replace(/\s+/g," ").toLowerCase();
                var objModel = obj.Model.toString().trim().replace(/\s+/g," ").toLowerCase();
                var itemMake = item.Make.toString().trim().replace(/\s+/g," ").toLowerCase();
                var itemModel = item.Model.toString().trim().replace(/\s+/g," ").toLowerCase();
                if(objMake == itemMake){
                  return objModel == itemModel || objModel == "";
                }else if(objModel == itemModel){
                  return objMake == itemMake || objMake == "";
                }
              });
              if(flag){
                return item;
              }
            });

            if(str.length>0){
              str.sort(function (a, b) {
                if (a.Make === b.Make) {
                  if (a.Model === b.Model) {
                    return a.Year - b.Year;
                  }else{
                    return compareString(a.Model, b.Model);
                  }
                }else{
                  return compareString(a.Make, b.Make);
                }
              });

              var allStr = str[0][headers[2]] + "," + str[0][headers[3]] + "," + str[0][headers[1]];
              for (var i = 1; i < str.length; i++) {
                if (str[i]) {
                  if ((str[i][headers[2]] == str[i - 1][headers[2]]) && (str[i][headers[3]] == str[i - 1][headers[3]])) {
                    if (str[i][headers[1]] != str[i - 1][headers[1]]) {
                      if (str[i][headers[1]] - str[i - 1][headers[1]] == 1) {
                        if (allStr.substring(allStr.lastIndexOf("-")).length == 5) {
                          allStr = allStr.substring(0, allStr.lastIndexOf("-")+1) + str[i][headers[1]];
                        } else {
                          allStr += "-" + str[i][headers[1]];
                        }
                      } else {
                        allStr += "," + str[i][headers[1]];
                      }
                    }
                  } else {
                    allStr += ";<br>" + str[i][headers[2]] + "," + str[i][headers[3]] + "," + str[i][headers[1]];
                  }
                }
              }
              var allArr = allStr.split(";<br>");
              yearAsBegin(allArr);

              allStr = allArr.join(";<br>");
              document.getElementById(importExcel).querySelector("tbody").innerHTML += "<tr><td>"
                    + str[0][headers[0]].toString().replace(/\s/g,"").replace(/^0/,"0&nbsp;")
                  + '</td><td contenteditable="true">' + allStr
                  + '</td><td contenteditable="true"></td><td class="details-result" contenteditable="true"></td></tr>';

              function sortUpdateYear(str,maxLen,Year,num,flag) {
                if(num>0){
                  num--;
                  sortByYear(str,Year);
                  if(allArr.length != maxLen){
                    if(allArr.length > maxLen){
                      if(!flag){
                        Year++;
                      }else{
                        return;
                      }
                    }else{
                      if(!flag){
                        flag = "del";
                      }
                      Year--;
                    }
                    sortUpdateYear(str,maxLen,Year,num,flag);
                  }else{
                    return;
                  }
                }else{
                  return;
                }
              }

              function sortByYear(str,Year) {
                allStr = str[0][headers[2]] + "," + str[0][headers[3]] + "," + str[0][headers[1]];
                for (var i = 1; i < str.length; i++) {
                  if (str[i] && Number(str[i][headers[1]].toString())>Year) {
                    if ((str[i][headers[2]] == str[i - 1][headers[2]]) && (str[i][headers[3]] == str[i - 1][headers[3]])) {
                      if (str[i][headers[1]] != str[i - 1][headers[1]]) {
                        if (str[i][headers[1]] - str[i - 1][headers[1]] == 1) {
                          if (allStr.substring(allStr.lastIndexOf("-")).length == 5) {
                            allStr = allStr.substring(0, allStr.lastIndexOf("-")+1) + str[i][headers[1]];
                          } else {
                            allStr += "-" + str[i][headers[1]];
                          }
                        } else {
                          allStr += "," + str[i][headers[1]];
                        }
                      }
                    } else {
                      allStr += ";<br>" + str[i][headers[2]] + "," + str[i][headers[3]] + "," + str[i][headers[1]];
                    }
                  }
                }
                allArr = allStr.split(";<br>");
              }
              document.getElementById(importExcel).nextElementSibling.style.display = "block";
            }
          }
        }
      }
    }

    function btn_export(importExcel) {
      var table = document.getElementById(importExcel).querySelector("table");
      var sheet = XLSX.utils.table_to_sheet(table); //将一个table对象转换成一个sheet对象
      var wb = sheet2blob(sheet);
      if ('ie' == getExplorer()) {
        window.navigator.msSaveOrOpenBlob(wb, 'excel.xlsx');
      }
      else {
        var oa = document.createElement('a');
        oa.href = URL.createObjectURL(wb);
        oa.download = 'excel.xlsx';
        document.body.appendChild(oa);
        oa.click();
        document.body.removeChild(oa);
      }
    }

    // 将一个sheet转成最终的excel文件的blob对象，然后利用URL.createObjectURL下载
    function sheet2blob(sheet, sheetName) {
      try {
        new Uint8Array([1, 2]).slice(0, 2);
      } catch (e) {
        console.log("[Uint8Array" + e.description + "]这里使用【Array.slice】。");
        //IE或有些浏览器不支持Uint8Array.slice()方法。改成使用Array.slice()方法
        Uint8Array.prototype.slice = Array.prototype.slice;
      }
      sheetName = sheetName || 'sheet1';
      var workbook = {
        SheetNames: [sheetName],
        Sheets: {}
      };
      workbook.Sheets[sheetName] = sheet;
      // 生成excel的配置项
      var wopts = {
        bookType: 'xlsx', // 要生成的文件类型
        bookSST: false, // 是否生成Shared String Table，官方解释是，如果开启生成速度会下降，但在低版本IOS设备上有更好的兼容性
        type: 'binary'
      };
      var wbout = XLSX.write(workbook, wopts);
      var blob = new Blob([s2ab(wbout)], { type: "application/octet-stream" });
      // 字符串转ArrayBuffer
      function s2ab(s) {
        var buf = new ArrayBuffer(s.length);
        var view = new Uint8Array(buf);
        for (var i = 0; i != s.length; ++i) view[i] = s.charCodeAt(i) & 0xFF;
        return buf;
      }
      return blob;
    }

    function getExplorer() {
      var explorer = window.navigator.userAgent;
      //ie
      if (explorer.indexOf("MSIE") >= 0) {
        return 'ie';
      }
      //Edge
      if (explorer.indexOf("Edge") >= 0) {
        return 'ie';
      }
      //Trident
      if (explorer.indexOf("Trident") >= 0) {
        return 'ie';
      }
      return '';
    }

    function yearAsBegin(allArr){
      for (var m = 0; m < allArr.length; m++) {
        if (allArr[m].trim().replace(/\s+/g, " ") != "") {
          var s1 = allArr[m].substr(0, allArr[m].indexOf(","));
          var s2 = allArr[m].substr(allArr[m].indexOf(",") + 1);
          var s3 = s2.substr(s2.indexOf(",") + 1);
          s2 = s2.substr(0, s2.indexOf(",")).replace(/\s+/g, " ");
          allArr[m] = s3 + " " + s1 + " " + s2;
        }
      }
    }

    function getMake(arr,k){
      return arr[k].substring(0, arr[k].indexOf(",")).trim().replace(/\s+/g,"");
    }

    function getModel(arr,k){
      var Model = arr[k].substring(arr[k].indexOf(",")+1);
      return Model.substring(0, Model.indexOf(",")).trim().replace(/\s+/g,"");
    }

    function compareString(a,b){
      var aVal = a.toString().toLocaleUpperCase().trim().replace(/\s+/g," ");
      var bVal = b.toString().toLocaleUpperCase().trim().replace(/\s+/g," ");
      if(parseFloat(aVal) && parseFloat(bVal)){
        aVal = parseFloat(aVal);
        bVal = parseFloat(bVal);
        return aVal === bVal ? 0 : aVal > bVal ? 1 : -1;
      }else{
        var reg = new RegExp("\\d+$");
        if(aVal.match(reg) && bVal.match(reg)){
          if(aVal.replace(/(\d+)$/g,"") === bVal.replace(/(\d+)$/g,"")){
            var reg = new RegExp("\\d+$");
            var aVal0 = parseFloat(aVal.match(reg));
            var bVal0 = parseFloat(bVal.match(reg));
          }else{
            var aVal0 = aVal.replace(/(\d+)$/g,"");
            var bVal0 = bVal.replace(/(\d+)$/g,"");
          }
          return aVal0 === bVal0 ? 0 : aVal0 > bVal0 ? 1 : -1;
        }else{
          return aVal === bVal ? 0 : aVal > bVal ? 1 : -1;
        }
      }
    }

    function handleDetails(ele, str2) {
      ele.previousElementSibling.innerText = str2;
      var str1 = ele.previousElementSibling.previousElementSibling.innerText;
      if(str1.replace(/\s/g,"")){
        str1 = str1.trim().replace(/\s+/g, " ");
        var strArr1 = str1.split(";");
        var modelStr = '<div class="part-fit">\n<h2>Part Fits For</h2>';
        if (strArr1.length > 20) {
          modelStr += '\n<div class="part-fit-radio">';
          for(var i=0; i<strArr1.length; i+=10){
            var mIndex = parseInt(i / 10) + 1;
            modelStr += '\n<input ';
            if(i==0){
              modelStr += 'checked="checked"';
            }
            modelStr += 'id="part-radio'+mIndex+'" class="part-radio" type="radio" name="part-radio">\n<div class="part-tab">\n<ul>';
            for(var j=0; j<10; j++){
              if(strArr1[i+j]){
                modelStr += "\n<li>" + strArr1[i+j].trim() + "</li>";
              }
            }
            modelStr += '\n</ul>\n</div>\n<label for="part-radio' + mIndex+'">'+ mIndex +'</label>';
          }
          modelStr += '\n<label>\n<a href="#vehicle_matching">&gt;&gt;</a>\n</label>\n</div>\n</div>';
        } else {
          modelStr += '\n<ul>';
          for (var i in strArr1) {
            if (strArr1[i].trim().replace(/\s+/g, " ") != "") {
              modelStr += "\n<li>" + strArr1[i].trim() + "</li>";
            }
          }
          modelStr += "\n</ul>\n</div>";
        }
        if(str2.indexOf('<div class="part-fit">')!=-1){
          var pStr1 = str2.substring(0,str2.indexOf("<h2>"));
          var pStr2 = str2.substring(str2.indexOf("</h2>")+5);
          pStr1=pStr1.substring(0,pStr1.indexOf('<div class="part-fit">'));
          pStr2=pStr2.substring(pStr2.indexOf('<h2>'));
          ele.innerText = pStr1 + modelStr + "\n" + pStr2;
        }else{
          var index2 = str2.indexOf("<h2>");
          ele.innerText = str2.substring(0, index2) + modelStr + "\n" + str2.substring(index2);
        }
      }else{
        ele.innerText = ele.previousElementSibling.innerText;
      }
    }

    function addItem(btn, item, container) {
      var itemHtml = item.innerHTML;
      btn.addEventListener("click",function () {
        var itemNode = document.createElement("div");
        itemNode.className = item.className;
        itemNode.innerHTML = itemHtml;
        container.appendChild(itemNode);
      });
    }

    function delItem(btn, itemSelector, container) {
      btn.addEventListener("click",function () {
        var itemList = container.querySelectorAll(itemSelector);
        if(itemList.length>1){
          container.removeChild(itemList[itemList.length-1])
        }
      });
    }
  </script>
</body>

</html>
